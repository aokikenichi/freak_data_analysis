# ヤバいデータ分析

# まえがき
　データ分析はなんて広いんだろう。影響力の強まりに応じ、自然・社会・人間ほぼすべてが対象となりどんどん拡大していく。対象に応じ手法も広がり複雑化し、学ぶべきことが多すぎる。データサイエンティスト協会のスキルチェックリストVer.3.00[^1]も500超の項目があります。読むべき図書も良書と思われるものだけでも増え続けており、もう手に負えない状況です。
ただ、これはやってはだめだ、ここを知らないと道に迷う、という絶対に知っておくべき点は学べる範囲だと思います。本書では、データ分析において間違えやすい、誤解しやすい点を共有し、データ分析全体をよくする目的で、かつ
- データ分析の技術書・専門書に分野ごとには書かれてはいるが1つにまとまっておらず目に触れにくいもの
- データ分析の技術書・専門書でもスルーされていたらい場合によっては誤っていると思われるもの

で自分なりに取り上げまとめました。
　本書でやや批判的に取り上げた方や書籍につきまして批判することが本意ではありません。取り上げた方や書籍は指摘事項以外は有用な方、書籍と判断したもののみ挙げております。
書名は、好著『ヤバい経済学』『ヤバい社会学』『ヤバい統計学』『ヤバい経営学』に憧れてつけました。「ヤバい」シリーズとテイストが変わっており質は低いですが、皆様の分析の一助となれば幸いです。

[^1]:https://www.datascientist.or.jp/common/docs/skillcheck_ver3.00.pdf

# I部：知らないとまずい
## 1. 人工知能と機械学習と統計学と
　今世の中で「AI」あるいは「人工知能」と言った場合に多くは機械学習のこと特に深層学習のことを指すことが多いと思われます。ただ、「ヨーロッパのAIスタートアップ40％がAIを使っていない…… 大事なのは定義か？」[^2]などという記事もあり、実際はITで何かやってるだけのことも多い。人により定義がバラバラでしかも人工知能、機械学習、統計学と似たような似てないような言葉が乱立しています。
　人工知能学会がまとめた「AI研究初学者と異分野研究者のためのAI研究の俯瞰図　AIマップ」[^3]というものがある。これを見るとAI研究といっても実に広いことがわかる。機械学習やその中の深層学習などはごくごく一部でしかない。この中では統計学はAI研究を支える技術ということになっている。
　例えば重回帰分析はAIなのか機械学習なのか統計学なのか。

　渋谷駅前で働くデータサイエンティストのブログの「『統計学と機械学習の違い』はどう論じたら良いのか」[^4]が私としてはしっくり来ている。

- 統計学はデータを「説明」することにより重きを置く
- 機械学習はデータから「予測」することにより重きを置く
- とは言え、統計学と機械学習の違いは基本的にはそれほど大きくないし互いに重なる部分だらけ

　なので重回帰分析は統計学の本にも出ていますし、機械学習の本にも出ています。でもそれをAIと言い出すと何だか違うんじゃねという気がします。でも重回帰分析でことが済めば全く問題がない。

　学術研究ではなくビジネスへの適用ならばやはり、AIか否か、機械学習か否か、統計学か否かではなく、課題設定しそれが解決できるか否か、に尽きるのだと。

結論
- 与太話は話半分^10くらいで聞き流そう
- AIマップなど専門家の物差しを活用しよう
- 課題設定しそれが解決できるか否かに尽きる

[^2]:https://ledge.ai/ai-definition-problem/
[^3]:https://www.ai-gakkai.or.jp/resource/aimap/
[^4]:https://tjo.hatenablog.com/entry/2015/09/17/190000

## 2. 〇〇学習
　とはいえ、学んでいくために概念の交通整理が必要です。〇〇学習とつくものをざっと挙げると

　機械学習、教師あり学習、半教師あり学習、教師なし学習、強化学習、深層学習（ディープラーニング）、多様体学習、転移学習、オンライン学習、バッチ学習、表現学習などがある。これらの関係を見ていく。

　包含関係を描くと下図のようになる。

<img width="616" alt="スクリーンショット 2023-05-05 13 32 53" src="https://user-images.githubusercontent.com/17631286/236378303-b8c959e0-be2a-41a3-9b5a-4acd6d857acb.png">

　人工知能の中に機械学習があり、その内訳として教師あり学習、教師なし学習、強化学習。人工知能には機械学習の他にもルールベースや推論、その他の技術がある。

- 機械学習
  - 機械学習の性質による分類
    - 教師あり学習
      - 正解となるデータを与えて、できるだけそれに近づくように学習させること。分類（判別）や回帰等がある。
    - 教師なし学習
      - 正解データを与えず、データからその特徴を見出すような学習をすること。クラスタリングや次元削減等がある。
    - 半教師あり学習
      - 一部のデータに正解を与え、正解が無いデータも、正解があるデータとの関連性から学習していく手法のこと。
    - 強化学習
      - 正解データはないが、環境を学習するエージェントがあり、エージェントが行動することで報酬を得て、その報酬を最大化するように行動しながら学習する手法のこと。
    - 転移学習
      - 一度教師ありで学習済みのモデルを元に、新たなデータで学習すること。学習済みのデータと新たなデータは異なるのだが似ていれば学習が応用できるという手法。
  - 機械学習の実行の仕方による分類
    - バッチ学習
      - データをひとまとめに投入して学習すること。小分けにして学習するミニバッチ学習もある
    - オンライン学習
      - データが入ってくるたびにその都度そのデータだけで学習すること
    - c.f. 「オンライン学習とバッチ学習」[^5]
  - 機械学習の手法・アルゴリズムの1つ
    - 深層学習
      - 機械学習の手法の1つである、ニューラルネットワークの1つ。ニューラルネットワークは入力層、中間層、出力層からなるが、中間層が多い（深い）ものを特に深層学習と呼ぶ。教師あり学習、教師なし学習、強化学習にも用いられる。
    - 多様体学習
      - 機械学習の手法の1つ。多様体とは、局所的にはユークリッド平面と同様にみなせる構造のこと。主に次元削減として、多次元のデータを多様体を通して低次元に縮約する技術。主成分分析PCAもその1つ。「【多様体学習】LLEとちょっとT-SNE」[^6]
- 似た言葉
  - データマイニング
    - Wikipedia:機械学習「データマイニングとの関係」[^7]にあるが
      - 機械学習の目的は、訓練データから学んだ「既知」の特徴に基づく予測である。
      - データマイニングの目的は、それまで「未知」だったデータの特徴を発見することである。
    - ただ、機械学習でも未知の特徴を発見するし、データマイニングでも予測をする部分もあるので、両者はかなりオーバーラップしている。私見だが、データを機械で学習させていまおうと研究していたグループが「機械学習」という言葉を使い、データから意味を見出そうぜと研究していたグループが「データマイニング」という言葉を使い、あれ同じことだよね、となっているのが現在と思っている。
  - 多変量解析
    - 統計学の1つで、1つの変数で検定などを行うのに比べて、多数の説明変数を扱う解析のことを読んでいると思う。これもデータマイニングと同じくかなり機械学習とオーバーラップがある。
  - 統計モデル
    - 「『統計学と機械学習の違い』はどう論じたら良いのか」[^8]が詳しいが、
      - 統計学はデータを「説明」することにより重きを置く
      - 機械学習はデータから「予測」することにより重きを置く

[^5]:https://dev.classmethod.jp/articles/online-batch-learning/
[^6]:https://www.hellocybernetics.tech/entry/2017/07/06/133450
[^7]:https://ja.wikipedia.org/wiki/%E6%A9%9F%E6%A2%B0%E5%AD%A6%E7%BF%92#%E3%83%87%E3%83%BC%E3%82%BF%E3%83%9E%E3%82%A4%E3%83%8B%E3%83%B3%E3%82%B0%E3%81%A8%E3%81%AE%E9%96%A2%E4%BF%82
[^8]:https://tjo.hatenablog.com/entry/2015/09/17/190000

## 3. データ分析手法に迷う前にまず図を描け
　まぁみんな図を描かない。図解の技術みたいな本がバカ売れするということは普段描かないからだろう。Excelでだって描けるのに。機械学習の入門本でも作図についてはサラッと流されていることが多い。
　データジャーナリズムという言葉もあるらしい。今回のコロナショックでは図を取り入れるメディアも増えた。
　ただ、作図の仕方はチュートリアルなりマニュアルを読めば分かるが、そもそもどういう図だと受け手に伝わるかが難しい。箱ひげ図をよく描くがあまりユーザー側に響かない。2020年のセンター試験数学に箱ひげ図が出ていたのでこれからの若い人は箱ひげ図は当たり前になるかもしれないがしばらくは受け入れられにくいのかもしれない。作図例などで発想を広げていくしかないかなと思う。

　言語ごとに代表的な作図ライブラリがあり、作図例も豊富。
- Python
  - Matplotlib: Visualization with Python[^9]
  - seaborn: statistical data visualization[^10]
  - Plotly Python Open Source Graphing Library[^11]
- R
  - ggplot2[^12]
    - 『Data Visualization A practical introduction』Kieran Healy[^13]
      - ライブラリではなく社会科学系で好評な書籍らしい。出版もされているが同内容をWebで読める。
- JavaScript
  - D3 Data-Driven Documents[^14]
  - Graph Gallery
    - Pythonでの作図ギャラリー
      - https://python-graph-gallery.com/
    - Rでの作図ギャラリー
      - https://www.r-graph-gallery.com/
    - JavaScript(D3.js)での作図ギャラリー
      - https://www.d3-graph-gallery.com/
    - 作図したい用途毎にチャート式で作図方法が選べる
      - https://www.data-to-viz.com/
-　言語毎ではなく使用する側として
  - BBC Style[^15]
    - Rにて、BBCが取り入れている作図のノウハウが見られる。

[^9]:https://matplotlib.org/
[^10]:https://seaborn.pydata.org/
[^11]:https://plotly.com/python/
[^12]:https://ggplot2.tidyverse.org/
[^13]:https://socviz.co/
[^14]:https://d3js.org/
[^15]:https://bbc.github.io/rcookbook/

## 4. データ分析手法はたくさんあるが使うのは5種類のみ
　複数の機械学習手法を統一したインターフェースで利用できるRのライブラリの一つcaretには学習法の一覧があり、2019-03-27現在238個の手法がある[^16]。ここにあるのは機械学習のみであり、この他にも統計学的手法もある。時系列データ、自然言語データ等にはそれぞれ特化した手法があるが、汎用的なデータの場合にはこの中から適切な手法を選んでいくことになる。ただ、よく使われるのはごく少数である。
　第2回データサイエンティストオブザイヤーを受賞した渋谷直正氏によると「実務で使う分析手法は5つで十分、マーケッターこそデータサイエンティスト候補」[^17]とのことである。

　分析手法を使う前の前提として、グラフを描く、であり、5つの手法とは、　
- 「クロス集計」
- 「ロジスティック回帰分析」
- 「決定木分析」
- 「アソシエーション分析」
- 「クラスター分析（k-平均法）」
 
である。マーケティング寄りかつ判別のみだが至って正論だと思う。

また、農業系の分析者への多数の講師経験のある食品産業技術総合研究機構の三中信宏氏の著書『統計思考の世界』[^18]においても

>	「計算する前によく見よう」「いかに可視化するか」「統計計算やモデリングの前に、生の情報をいかにきちんと”見る”かは統計グラフィクスやインフォグラフィクスの最前線につながっていきます」「もっと図表を！」

と図を描くことの重要性を強調しておられます。
　
　まずこれらをしてから深い分析が必要、あるいは回帰の場合に別の手法を考えればよいと思います。
　そして補足。入門書によく出てくるサポートベクターマシンですが、理解が難しめな割には精度が出ず、ビジネス実務でもKaggleのようなコンペティションでもほとんど使われないかと思います（カーネル法の考え方はあちこちで使われ重要ですが入門において他の手法と同じ重要さで学ぶべきとは思えません。

　その他詳しくはQiita「氷解！データ分析、機械学習手法ってたくさんあるけどいつどれを使えばよいのか」[^19]に書いたので読んでいただきたい。

結論
- ビジネスデータ（判別が中心）の場合はまず下記5つに習熟のこと。
  - クロス集計
  - ロジスティック回帰分析
  - 決定木分析
  - アソシエーション分析
  - クラスター分析（k-平均法）
- 回帰を含みより深く分析する場合は下記5つに習熟のこと。
  - 説明性を重視する場合（青木注：最近では機械学習の説明・解釈性としてSHAPなどの手法が出てきており、重回帰や決定木にこだわる必要性は減ってきたかも）
    - 回帰
      - 重回帰分析
      - 回帰木分析
    - 判別
      - ロジスティック回帰分析
      - 決定木分析
    - 予測精度を重視する場合
      - 回帰、判別とも
        - アンサンブル学習（精度の良さと計算の高速性からlightgbm）
-　つまり、クロス集計、木、重回帰、ロジスティック回帰、アンサンブル学習、をきちんと学ぶことが重要かと。 

[^16]:https://topepo.github.io/caret/available-models.html
[^17]:https://lp.sendenkaigi.com/marketing
[^18]:三中信宏． 統計思考の世界． 技術評論社， 2018， 240p.
[^19]:https://qiita.com/aokikenichi/items/688e66d10a944051039c

## 5. 【要修正】データ分析に必要な数学は？ __★★★この項だけ長すぎるかまた２０２０年くらいの古い情報なので要整理★★★__

　センター試験数学Ⅰで箱ひげ図が出てきている。データ分析とデータ分析に数学を用いるのが一般的になってきているのだろう。
　データ分析には数学が必要だと人は言う。大学一年レベルの数学で十分だと言われたり、もっと必要だと言われたり。
　一般人のイメージする数学は
 
$$\int_a^b{xdx}$$

 みたいなのだろうけど数学って本当に広い（Masaki Koga 氏の「数学にはどんな研究分野がある？数学の世界地図を紹介！！」[^20]）。ならば数学全般ではなく、データサイエンス系の大学のカリキュラムを見ればいいではないかとのことで[^21]

|      | 滋賀大学[^22] | 横浜市立大学[^23] |東京都市大学[^24] |
| :--- | :---         | :---            | :---          |
| １年  | 解析学<br/>線形代数<br/>統計学要論 | 集合位相<br/>微分積分学<br/>線形代数<br/>統計の数理 |微分積分学<br/>線形代数学<br/>基礎確率統計<br/>数理統計 |
| 2年  | 統計数学<br/>応用数学[^25] | 情報理論<br/>代数学<br/>応用統計学 | 微分方程式論<br/>ベクトル解析学<br/>代数学<br/>フーリエ解析学<br/>関数論<br/>情報理論<br/>オペレーションズリサーチ |
| 3年  | 最適化理論<br/>確率論 | 最適化理論 | - |
| 4年  |情報理論<br/>統計学特論 | - | - |

 大学ではないが、東京大学エクステンション・データサイエンススクール・技術実務者コースでは
- 前提知識　高校までの理系数学と大学1・2年生の数学の一部（偏微分、積分、行列）
- 数学科目　統計学、最適化

ざっくりまとめると

- 高校1年[^26]
  - 数学Ⅰ
    - 数と式、図形と計量、二次関数、データの分析
  - 数学A
    - 図形の性質、場合の数と確率、数学と人間の活動
- 高校2年
  - 数学Ⅱ
    - いろいろな式、図形と方程式、いろいろか関数、微分・積分の考え
  - 数学B
    - 数列、統計的な推測
- 高校3年
  - 数学Ⅲ
    - 極限、微分法、積分法
  - 数学C
    - ベクトル、平面上の曲線と複素数平面、数学的な表現の工夫
      - 「数学的な表現の工夫」の1つに「行列」があるがデータ分析に重要な線形代数の基本はほとんどなく大学に入ってから
- 大学1年
  - 微分積分学
    - 解析学の一部なので「解析学」という科目の場合あり
    - 高校までの微分積分との大きな違いは、
      - 定義が厳密になる
      - 高校　1変数のみ
      - 大学　複数の変数を扱う　偏微分　重積分　などが登場する
  - 線形代数学
  - 統計学
    - 「確率統計学」という科目の場合あり。「確率論」はまた別の科目
  - （集合・位相）
    - 上位の数学をする場合には必須だが抽象的で難易度が高く、他の科目でさらっと入り口を眺めるだけの場合とほぼ学ばない場合もあり
- 大学2年以上
  - 応用統計学
    - 多変量解析など機械学習に近い科目
  - 最適化理論
    - 機械学習の理論の中核を担う科目
  - 情報理論
    - データの中にどれだけ有益な情報と、無益なノイズが入っているかなどを問う科目
  - 離散数学
    - 大学や教科書によってスコープが異なることが多いが、組合せ問題やグラフ理論などを扱う科目

　データ分析について数学以外も学んで、必要な数学について私がいろいろ学んだ結果として
- 「データサイエンス、データ分析、機械学習関連の本」[^27]
  - 推薦図書の一覧
- 「データ分析関連（データサイエンス、データ分析、機械学習）書籍マップ Ver.1.00」[^28]
  - 推薦図書の読み進める順番、前提知識、次に読む本の繋がり
- 「データサイエンティスト協会スキルチェックリストver.3.00『データサイエンティスト』に必要な本」[^29]
  - スキルチェックリストのスキルを学ぶために必要な本
- 数学は楽をするためにある－機械学習のための数学入門前の準備体操～その１数学記号、公理・定義・定理、微分積分～[^30]
  - あ
- データサイエンス、データ分析、機械学習に必要な数学[^31]
  - あ
データサイエンス、データ分析、機械学習に必要な数学２[^32]
  - あ

まとめみると
- 微分積分
  - 統計学はいろいろな分布を扱うが、分布は関数である。関数の特徴を知るためには、細かく分けて見る微分、そして細かく分けたものを1つに足し合わせてまとめる積分が必要となる。
  - 機械学習ではデータから学習モデルを作る。そしてその学習モデルとデータとの誤差を最小にする。学習モデルとは関数であり、データとの誤差も関数となる。関数を採用にするためには傾きの議論が必要であり、微分が必要となる。
- 線形代数
  - データはだいたいの場合において特徴を示す列とサンプルが1行となる行列の形であらわされ、行列を扱う線形代数が必要となる。
  - データの特徴をより少ないデータで表すために行列の性質を用いてデータを分解する必要場合に線形代数が必要となる。
- 統計学
  - あ
- 集合・位相
  - あ
- 最適化理論
- 微分幾何学、位相幾何学
  - データを形として捉えるほうが都合がいい場合があり、形を扱う幾何学が必要となる。
  - 多様体学習
    - TDA
- 関数解析
  - あ
- 代数学
- 群論
  - あ

[^20]:https://note.com/masakikoga1/n/n3ce9436e0a1c
[^21]:武蔵野大学にもデータサイエンス学部があるがカリキュラム上で数学の科目を明示していないので略。数学と情報工学やデータ分析の境界線上の科目もある。また、データ分析系の科目の中で必要な数学を学ぶと言うのもありえるため、ざっくりとした分類で失礼。
[^22]:データサイエンス学部データサイエンス研究科 https://www.ds.shiga-u.ac.jp/about/ds/curriculum/
[^23]:データサイエンス学部データサイエンス学科 https://www.yokohama-cu.ac.jp/academics/ds/curriculum.html
[^24]:知識知能情報工学科 https://www.tcu.ac.jp/tcucms/wp-content/uploads/2019/06/curriculm2019-c-02.pdf
[^25]:離散数学、グラフ理論、待ち行列などらしい https://success.shiga-u.ac.jp/Portal/Public/Syllabus/DetailMain.aspx?lct_year=2020&lct_cd=7022100701
[^26]:数学 (教科) - Wikipedia 細かく変更があるが2022年からの新課程で例示
[^27]:https://qiita.com/aokikenichi/items/ae4df263f591e47528a6
[^28]:https://qiita.com/aokikenichi/items/6bbb4d2a00f979927be4
[^29]:https://qiita.com/aokikenichi/items/febcc7ae4f803050e90b
[^30]:https://qiita.com/aokikenichi/items/8fcf8b2401438af71cd2
[^31]:https://qiita.com/aokikenichi/items/4d683dc5774f844f8113
[^32]:https://qiita.com/aokikenichi/items/229f2886578f5eee4649




#　II部：知っていると得
